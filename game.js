function addSpacesBefore(o,r){for(;r.length<o;)r=" "+r;return r}function printRoom(){for(var o=id("game-area"),r="",t=0;t<currentRoom.arr.length;t++){for(var e=0;e<currentRoom.arr[t].length;e++)t==player.row&&e==player.col?r+=charString(player):null!=currentRoom.arr[t][e]?r+=charString(currentRoom.arr[t][e]):null!=currentRoom.items[t][e]?r+=charString(currentRoom.items[t][e]):r+=" ";r+="\n"}o.innerHTML=r}function charString(o){return o.color?'<span style="color:'+o.color+'">'+o.char+"</span>":o.char}function printSidebar(){for(var o="+",r=map[0].length+2,t=0;t<map[0].length;t++)o+="=";o+="+\n";for(t=0;t<map.length;t++){o+="|";for(var e=0;e<map[t].length;e++)map[t][e]==currentRoom?o+="O":null!=map[t][e]?o+="*":o+=" ";o+="|\n"}o+="+";for(t=0;t<map[0].length;t++)o+="=";o+="+\n\n";var n="",a=Math.ceil(health);for(t=0;t<maxHealth-a;t++)n+=heartContainer.char;for(t=0;t<a;t++)n+=heart.char;o+=addSpacesBefore(r,n),o+="\n\n",0<coins&&(o+=addSpacesBefore(r,coins+coin.char)+"\n\n"),id("map").innerHTML=o}function printDeathMessage(){id("game-area").innerHTML=" __   __  _______  __   __    ______   ___   _______  ______\n|  | |  ||       ||  | |  |  |      | |   | |       ||      |\n|  |_|  ||   _   ||  | |  |  |  _    ||   | |    ___||  _    |\n|       ||  | |  ||  |_|  |  | | |   ||   | |   |___ | | |   |\n|_     _||  |_|  ||       |  | |_|   ||   | |    ___|| |_|   |\n  |   |  |       ||       |  |       ||   | |   |___ |       |\n  |___|  |_______||_______|  |______| |___| |_______||______|"}function id(o){return document.getElementById(o)}var keysDown=[];function addKeyToKeyArray(o){keysDown.includes(o.keyCode)||keysDown.unshift(o.keyCode)}function removeKeyFromKeyArray(o){var r=keysDown.indexOf(o.keyCode);-1<r&&keysDown.splice(r,1)}function keyCheck(){movingL=movingR=movingU=movingD=!1;for(var o=0;o<keysDown.length;o++){var r=keysDown[o];65==r?movingL=!0:68==r?movingR=!0:87==r?movingU=!0:83==r&&(movingD=!0),canShoot&&(73==r?playerShoot(-1,0):74==r?playerShoot(0,-1):75==r?playerShoot(1,0):76==r&&playerShoot(0,1))}}var map,currentRoom,coin={char:"¢",color:"GoldenRod"},heart={char:"•"},heartContainer={char:"×"};function generateRooms(){for(var o=[];o.length<100;){map=new Array(12);for(var r=[],t=0;t<12;t++){map[t]=new Array(20);for(var e=0;e<map[t].length;e++)Math.random()<.5&&(map[t][e]=new room(t,e),r.push(map[t][e]))}o=getConnectedRooms((currentRoom=r[randomInt(0,r.length-1)]).row,currentRoom.col,new Array);for(t=0;t<r.length;t++)o.includes(r[t])||(map[r[t].row][r[t].col]=null)}for(t=0;t<o.length;t++)o[t].generateRoom();generateDoors(o);for(t=0;t<o.length;t++)if(4==o[t].doors.length){currentRoom=o[t];break}currentRoom.enemyFree=!0}function generateDoors(o){for(var r=0;r<o.length;r++){if(null==o[r].topDoor&&mapContains(o[r].row-1,o[r].col)&&null!=map[o[r].row-1][o[r].col]){var t=map[o[r].row-1][o[r].col],e=o[r].addDoorAtRow(0),n=t.addDoorAtRow(t.arr.length-1);(e.opposite=n).opposite=e}if(null==o[r].bottomDoor&&mapContains(o[r].row+1,o[r].col)&&null!=map[o[r].row+1][o[r].col]){t=map[o[r].row+1][o[r].col],e=o[r].addDoorAtRow(o[r].arr.length-1),n=t.addDoorAtRow(0);(e.opposite=n).opposite=e}if(null==o[r].leftDoor&&mapContains(o[r].row,o[r].col-1)&&null!=map[o[r].row][o[r].col-1]){t=map[o[r].row][o[r].col-1],e=o[r].addDoorAtCol(0),n=t.addDoorAtCol(t.arr[0].length-1);(e.opposite=n).opposite=e}if(null==o[r].rightDoor&&mapContains(o[r].row,o[r].col+1)&&null!=map[o[r].row][o[r].col+1]){t=map[o[r].row][o[r].col+1],e=o[r].addDoorAtCol(o[r].arr[0].length-1),n=t.addDoorAtCol(0);(e.opposite=n).opposite=e}}}function getConnectedRooms(o,r,t){return mapContains(o,r)&&!t.includes(map[o][r])&&null!=map[o][r]&&(t.push(map[o][r]),getConnectedRooms(o+1,r,t),getConnectedRooms(o-1,r,t),getConnectedRooms(o,r+1,t),getConnectedRooms(o,r-1,t)),t}function mapContains(o,r){return 0<=o&&o<map.length&&0<=r&&r<map[0].length}function loadRoomAt(o,r,t){mapContains(o,r)&&null!=map[o][r]&&(currentRoom.arr[player.row][player.col]=null,currentRoom=map[o][r],addPlayerToRoom(t),currentRoom.enemyFree||currentRoom.enemiesHaveBeenSpawned?currentRoom.enemiesHaveBeenSpawned:currentRoom.generateEnemies(),printSidebar())}var movingL=!(window.onload=function(){window.onkeydown=addKeyToKeyArray,window.onkeyup=removeKeyFromKeyArray,generateRooms(),currentRoom.roomComplete(),printSidebar(),addPlayerToRoom(),gameLoop=setInterval(function(){0<health?(updatePlayer(),keyCheck(),currentRoom.updateEnemies(),printRoom()):printDeathMessage()},75)}),movingR=!1,movingU=!1,movingD=!1,canShoot=!0,maxHealth=3,health=maxHealth,coins=0,player={char:"$",solid:!0,color:"CornflowerBlue",damage:function(o){console.log("hit"),health-=o,printSidebar()}};function updatePlayer(){var o=(movingU?-1:0)+(movingD?1:0),r=(movingL?-1:0)+(movingR?1:0);if((0!=o||0!=r)&&(currentRoom.arr[player.row][player.col]=null,!loadNewRoomIfOutside(player.row+o,player.col+r))){canStandAt(currentRoom.arr[player.row+o][player.col+r])?(player.row+=o,player.col+=r):canStandAt(currentRoom.arr[player.row+o][player.col])?player.row+=o:canStandAt(currentRoom.arr[player.row][player.col+r])&&(player.col+=r);var t=currentRoom.items[player.row][player.col];null!=t&&(playerPickup(t),currentRoom.items[player.row][player.col]=null),currentRoom.arr[player.row][player.col]=player}}function playerPickup(o){o==coin&&(coins++,printSidebar())}function playerShoot(o,r){canShoot=!1;setTimeout(function(){canShoot=!0},200);var t=player.row+(0!=o?1:0)*(o<0?-1:1),e=player.col+(0!=r?1:0)*(r<0?-1:1);placeProjectileAt(new projectile(t,e,o,r,currentRoom),t,e)}function projectile(o,r,t,e,n){this.room=n,this.char="o",this.rowDir=t,this.colDir=e,this.rowPos=o,this.colPos=r,this.color="gray";var a=this;this.timer=setInterval(function(){updateProjectile(a)},40),this.destroy=function(){clearInterval(this.timer);var o=Math.floor(this.rowPos-this.rowDir),r=Math.floor(this.colPos-this.colDir);this.room.arr[o][r]==a&&(this.room.arr[o][r]=null)}}function updateProjectile(o){var r=Math.floor(o.rowPos),t=Math.floor(o.colPos);o.room.arr[r][t]=null,o.rowPos+=o.rowDir,o.colPos+=o.colDir,placeProjectileAt(o,r=Math.floor(o.rowPos),t=Math.floor(o.colPos))}function placeProjectileAt(o,r,t){if(roomContains(r,t,o.room)){var e=o.room.arr[r][t];null!=e&&e.solid?(null!=e.damage&&e.damage(),o.destroy()):o.room.arr[r][t]=o}else o.destroy()}function room(o,r){this.width=randomInt(20,50),this.height=randomInt(10,30),this.completed=!1,this.row=o,this.col=r,this.arr=new Array(this.height),this.items=new Array(this.height),this.generateRoom=function(){for(var o=this.arr,r=0;r<o.length;r++)o[r]=new Array(this.width),o[r][0]=wall,o[r][o[r].length-1]=wall,this.items[r]=new Array(this.width);for(r=0;r<o[0].length;r++)o[0][r]=wall,o[o.length-1][r]=wall},this.doors=[],this.bottomDoor=null,this.topDoor=null,this.leftDoor=null,this.rightDoor=null,this.enemies=[],this.addDoorAtRow=function(o){var r=randomInt(3,this.arr[0].length-4),t=new door(this,[o,r,o,r+1,o,r-1]);return this.doors.push(t),0==o?this.topDoor=t:this.bottomDoor=t,t},this.addDoorAtCol=function(o){var r=randomInt(3,this.arr.length-4),t=new door(this,[r,o,r+1,o,r-1,o]);return this.doors.push(t),0==o?this.leftDoor=t:this.rightDoor=t,t},this.roomComplete=function(){this.completed=!0;for(var o=0;o<this.doors.length;o++)this.doors[o].open()},this.generateEnemies=function(){this.enemiesHaveBeenSpawned=!0;for(var o=0;o<5;o++){for(var r=randomInt(2,this.height-3),t=randomInt(2,this.width-3);null!=this.arr[r][t];)r=randomInt(2,this.height-3),t=randomInt(2,this.width-3);var e=new zombie(this,r,t);this.enemies.push(e),this.arr[r][t]=e}},this.updateEnemies=function(){for(var o=0;o<this.enemies.length;o++)this.enemies[o].dead?(this.enemies.splice(o,1),o--):this.enemies[o].move();0==this.enemies.length&&this.roomComplete()}}function door(r,o){this.solid=!0,this.char="D",this.locations=o,this.room=r,this.opened=!1;for(var t=0;t<o.length;t+=2)r.arr[o[t]][o[t+1]]=this;this.open=function(){if(!this.opened){this.opened=!0;for(var o=0;o<this.locations.length;o+=2)r.arr[this.locations[o]][this.locations[o+1]]=null;null!=this.opposite&&this.opposite.open()}}}function dropItem(o,r,t,e){r.items[t][e]=o}function roomContains(o,r,t){return t||(t=currentRoom),0<=o&&o<t.arr.length&&0<=r&&r<t.arr[0].length}function addPlayerToRoom(o){if(o){var r=null;r="left"==o?currentRoom.leftDoor:"right"==o?currentRoom.rightDoor:"top"==o?currentRoom.topDoor:currentRoom.bottomDoor,player.row=r.locations[0],player.col=r.locations[1]}else player.row=Math.floor(currentRoom.arr.length/2),player.col=Math.floor(currentRoom.arr[0].length/2);currentRoom.arr[player.row][player.col]=player}function loadNewRoomIfOutside(o,r){return o<0?(loadRoomAt(currentRoom.row-1,currentRoom.col,"bottom"),!0):o>=currentRoom.arr.length?(loadRoomAt(currentRoom.row+1,currentRoom.col,"top"),!0):r<0?(loadRoomAt(currentRoom.row,currentRoom.col-1,"right"),!0):r>=currentRoom.arr[0].length&&(loadRoomAt(currentRoom.row,currentRoom.col+1,"left"),!0)}function canStandAt(o){return null==o||!o.solid}function randomInt(o,r){return Math.floor(Math.random()*(r-o+1))+o}var wall={char:"W",solid:!0};function zombie(o,r,t){this.room=o,this.row=r,this.col=t,this.rowFloat=r,this.colFloat=t,this.char="Z",this.solid=!0,this.health=2,this.moveDist=.3,this.strength=.1,this.color="OliveDrab",this.damage=function(){this.health--,this.health<=0&&this.die()},this.die=function(){this.dead=!0,this.room.arr[this.row][this.col]=null,.5<Math.random()&&dropItem(coin,this.room,this.row,this.col)},this.move=function(){if(roomContains(this.row,this.col,this.room)){if(this.room.arr[this.row][this.col]=null,1==Math.abs(player.row-this.row)&&this.col==player.col||1==Math.abs(player.col-this.col)&&this.row==player.row)player.damage(this.strength);else{var o=Math.atan((this.row-player.row)/(player.col-this.col)),r=this.moveDist*Math.cos(o)*(player.col<this.col?-1:1),t=Math.abs(this.moveDist*Math.sin(o))*(player.row<this.row?-1:1),e=Math.floor(this.colFloat+r),n=Math.floor(this.rowFloat+t);roomContains(n,e,this.room)&&canStandAt(this.room.arr[n][e])&&(this.row=n,this.col=e,this.colFloat+=r,this.rowFloat+=t)}this.room.arr[this.row][this.col]=this}else this.die()}}